pipeline {
  agent any
  tools {
    jdk 'JDK21'
    maven 'Maven3'
  }
  stages {
    stage('Checkout') { steps { git branch: 'main', url: 'https://github.com/riadhbelgacem/TPGIT.git' } }
    stage('Compile') { steps { sh 'mvn -B -DskipTests clean compile' } }
    stage('Execute') { steps { sh 'mvn -q exec:java -Dexec.mainClass=Main || true' } } // only if exec plugin configured
    stage('SonarQube Analysis') {
      steps {
        // Name MUST match the SonarQube server name in Configure System
        withSonarQubeEnv('MySonarQubeServer') {
          sh 'mvn -B sonar:sonar'
        }
      }
    }
  }
}
